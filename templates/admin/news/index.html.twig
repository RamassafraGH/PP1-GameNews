#[Route('/', name: 'app_news_index')]
public function index(
    Request $request,
    NewsRepository $newsRepository,
    PaginatorInterface $paginator
): Response {
    $searchForm = $this->createForm(SearchFormType::class);
    $searchForm->handleRequest($request);

    $hasSearch = false;
    $appliedFilters = [];

    // Query base
    $queryBuilder = $newsRepository->createQueryBuilder('n')
        ->where('n.status = :status')
        ->setParameter('status', 'published')
        ->orderBy('n.publishedAt', 'DESC');

    // Si el formulario fue enviado
    if ($searchForm->isSubmitted()) {
        $data = $searchForm->getData();
        
        // Verificar si hay filtros aplicados
        $hasQuery = !empty(trim($data['query'] ?? ''));
        $hasCategory = $data['category'] !== null;
        $hasTag = $data['tag'] !== null;
        $hasDateFrom = $data['dateFrom'] !== null;
        $hasDateTo = $data['dateTo'] !== null;

        // Si hay al menos un filtro, marcar como búsqueda activa
        if ($hasQuery || $hasCategory || $hasTag || $hasDateFrom || $hasDateTo) {
            $hasSearch = true;

            // Aplicar búsqueda avanzada
            $queryBuilder = $newsRepository->searchNews(
                $data['query'] ?? null,
                $data['category'] ?? null,
                $data['tag'] ?? null,
                $data['dateFrom'] ?? null,
                $data['dateTo'] ?? null
            );

            // Construir array de filtros aplicados para mostrar
            if ($hasQuery) {
                $appliedFilters[] = 'Texto: "' . $data['query'] . '"';
            }
            if ($hasCategory) {
                $appliedFilters[] = 'Categoría: ' . $data['category']->getName();
            }
            if ($hasTag) {
                $appliedFilters[] = 'Etiqueta: ' . $data['tag']->getName();
            }
            if ($hasDateFrom || $hasDateTo) {
                $dateRange = 'Fecha: ';
                if ($hasDateFrom) {
                    $dateRange .= 'desde ' . $data['dateFrom']->format('d/m/Y');
                }
                if ($hasDateTo) {
                    $dateRange .= ' hasta ' . $data['dateTo']->format('d/m/Y');
                }
                $appliedFilters[] = $dateRange;
            }
        }
    }

    $pagination = $paginator->paginate(
        $queryBuilder,
        $request->query->getInt('page', 1),
        12
    );

    return $this->render('news/index.html.twig', [
        'pagination' => $pagination,
        'searchForm' => $searchForm->createView(),
        'hasSearch' => $hasSearch,
        'appliedFilters' => $appliedFilters,
    ]);
}